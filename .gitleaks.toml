# Gitleaks configuration for Event Horizon
# Strict allowlist for public Stripe payment links only

title = "Event Horizon Secret Scanning"

[extend]
# Use default rules
useDefault = true

[allowlist]
description = "Allow public Stripe payment links only"
paths = [
  '''\.env\.example$''',
  '''docs/.*''',
  '''\.github/.*''',
  '''node_modules/.*''',
  '''\.next/.*''',
  '''coffee\.png$''',
  # Allow payment links file - multiple patterns to ensure match
  '''^app/api/donations/payment-links/route\.ts$''',
  '''app/api/donations/payment-links/route\.ts''',
  '''.*payment-links.*''',
  '''.*/payment-links/.*''',
]

commits = [
  # Allow example patterns in documentation
  '''your_stripe_secret_key_here''',
  '''your_mapbox_token_here''',
  '''your_supabase_url_here''',
]

regexes = [
  # Strictly match public payment links; anchors avoid overmatch
  # Only allow buy.stripe.com payment links (public URLs, not secrets)
  # Match exact payment link format (20+ alphanumeric chars after /)
  '''https://buy\.stripe\.com/[A-Za-z0-9]{20,}''',
  '''https://buy\.stripe\.com/[A-Za-z0-9]+''',
  '''https?://buy\.stripe\.com/[A-Za-z0-9_\-/?=&#%]+''',
  # Allow example patterns in docs
  '''sk_live_\.\.\.''',
  '''sk_test_\.\.\.''',
  '''pk_live_\.\.\.''',
  '''pk_test_\.\.\.''',
]

# Do NOT add stripe.com to stops - we want to catch real secrets like sk_live_...

# Additional allowlist for specific payment link IDs (as fallback)
[allowlist.stops]
stops = [
  '''6oUfZhbYA0ofaz9f9h6c000''',  # $3 payment link
  '''cNifZh3s46MD8r10en6c001''',  # $5 payment link
  '''6oUdR92o0db1cHh3qz6c002''',  # $10 payment link
  '''cNi6oH2o02wn8r1bX56c003''',  # $25 payment link
  '''7sY6oH0fS4Ev5eP1ir6c004''',  # $50 payment link
]
